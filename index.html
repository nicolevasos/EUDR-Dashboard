<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Whisp Risk Analysis</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Chart.js and plugins -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<!-- D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Custom CSS -->
<link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-900 text-gray-200 h-screen flex flex-col overflow-hidden font-sans">

<!-- ----- Welcome Modal ----- -->
<div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-gray-800 text-white p-8 rounded-2xl text-center max-w-md w-full shadow-lg">
    <h2 class="text-2xl font-bold mb-4">Welcome to Whisp Dashboard</h2>
    <p class="mb-6 text-gray-300">Choose your data source to begin analysis:</p>
    <button id="defaultDataBtn" class="bg-green-600 px-5 py-2 rounded-lg mb-4 w-full font-semibold hover:bg-green-500 transition">Use Default Dataset</button>
    <p class="mb-3 text-gray-400">— OR —</p>
    <input type="file" id="uploadDataInput" accept=".csv" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600"/>
  </div>
</div>

<!-- ----- Header ----- -->
<header class="flex-none flex items-center justify-between p-4 bg-gray-800 shadow-lg">
  <h1 class="text-2xl font-bold tracking-wide">🌍 Whisp Dashboard</h1>
  <button id="resetBtn" class="bg-gray-700 px-4 py-2 rounded-lg hover:bg-gray-600 transition">Reset Filters</button>
</header>

<!-- ----- Main Grid ----- -->
<main class="flex-1 grid grid-cols-6 gap-4 p-4 min-h-0 text-[0.825rem]">

  <!-- Left Sidebar -->
  <section class="col-span-2 flex flex-col min-h-0 space-y-4">
    <!-- Filters -->
    <div class="bg-gray-800 p-4 rounded-2xl shadow-md">
      <h2 class="dashboard-title">Filters</h2>
      <div class="space-y-3">
        <div>
          <label class="block text-[0.7rem] text-gray-400 mb-1">Country:</label>
          <select id="countryFilter" class="w-full bg-gray-700 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></select>
        </div>
        <div>
          <label class="block text-[0.7rem] text-gray-400 mb-1">Administrative Level 1:</label>
          <select id="admin2Filter" class="w-full bg-gray-700 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></select>
        </div>
      </div>
    </div>

    <!-- Map -->
    <div class="bg-gray-800 rounded-2xl shadow-lg flex flex-col flex-1 overflow-hidden">
      <h2 class="dashboard-title" style="margin:1rem;margin-bottom:0.7rem">Plot locations</h2> 
      <div id="map" class="flex-1"></div>
    </div>

    <!-- Pie Chart -->
    <div class="bg-gray-800 rounded-2xl shadow-lg flex flex-col items-center justify-center p-4 max-w-[200px] mx-auto">
      <h2 class="dashboard-title">Risk Category</h2>
      <canvas id="riskPie" class="w-full h-full"></canvas>
    </div>
  </section>

  <!-- Middle Panel -->
  <section class="col-span-3 grid grid-cols-2 gap-4 min-h-0">
    <!-- Table -->
    <div class="bg-gray-800 rounded-2xl flex flex-col min-h-0 p-4 shadow-lg">
      <h2 class="dashboard-title">Plot Area by Risk Category</h2>
      <div class="overflow-auto flex-1 min-h-0 border border-gray-700 rounded-lg mb-4">
        <table id="riskTable" class="w-full text-center">
          <thead class="bg-gray-700 text-gray-300 sticky top-0">
            <tr>
              <th class="px-2 py-1">Country</th>
              <th class="px-2 py-1"># Plots</th>
              <th class="px-2 py-1">Sum of Area</th>
              <th class="px-2 py-1">High</th>
              <th class="px-2 py-1">Low</th>
              <th class="px-2 py-1">Need Info</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700"></tbody>
        </table>
      </div>

      <!-- Treecover & Water Flag Panel -->
      <div class="bg-gray-800 p-4 rounded-2xl shadow flex space-x-4">
        <div class="bg-gray-700 p-3 rounded-xl flex-1 flex flex-col justify-center shadow small-indicator">
          <h3 class="dashboard-title">🌲 Treecover</h3>
          <p id="treecover" class="text-left text-[0.825rem]"></p>
        </div>
        <div class="bg-gray-700 p-3 rounded-xl flex-1 flex flex-col justify-center shadow small-indicator">
          <h3 class="dashboard-title">💧 Water Flag</h3>
          <p id="waterFlag" class="text-left text-[0.825rem]"></p>
        </div>
      </div>
    </div>

    <!-- Bar Charts -->
    <div class="grid grid-rows-4 gap-3 min-h-0">
      <div class="bg-gray-800 p-3 rounded-2xl shadow"><canvas id="gfcChart"></canvas></div>
      <div class="bg-gray-800 p-3 rounded-2xl shadow"><canvas id="tmfChart"></canvas></div>
      <div class="bg-gray-800 p-3 rounded-2xl shadow"><canvas id="raddChart"></canvas></div>
      <div class="bg-gray-800 p-3 rounded-2xl shadow"><canvas id="modisChart"></canvas></div>
    </div>
  </section>

  <!-- Right Sidebar -->
  <aside class="col-span-1 flex flex-col min-h-0 gap-4 overflow-auto text-[0.825rem]">
    <div class="bg-gray-800 p-4 rounded-2xl flex-1 min-h-0 shadow">
      <h3 class="dashboard-title">🌳 Primary Forest Indicator</h3>
      <p id="primaryIndicator" class="text-xs"></p>
    </div>
    <div class="bg-gray-800 p-4 rounded-2xl flex-1 min-h-0 shadow">
      <h3 class="dashboard-title">🌾 Commodity Indicator</h3>
      <p id="commodityIndicator" class="text-xs"></p>
    </div>
    <div class="bg-gray-800 p-4 rounded-2xl flex-1 min-h-0 shadow">
      <h3 class="dashboard-title">⚡ Disturbance Pre 2020</h3>
      <p id="disturbancePre" class="text-xs"></p>
    </div>
    <div class="bg-gray-800 p-4 rounded-2xl flex-1 min-h-0 shadow">
      <h3 class="dashboard-title">🔥 Disturbance Post 2020</h3>
      <p id="disturbancePost" class="text-xs"></p>
    </div>
  </aside>
</main>

<!-- Custom JS at the end -->
<script src="dashboard.js"></script>
</body>
</html>
